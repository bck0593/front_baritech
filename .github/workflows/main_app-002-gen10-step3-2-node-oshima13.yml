name: Build and deploy Node.js app to Azure Web App - app-002-gen10-step3-2-node-oshima13

on: push: branches: [ main ] workflow_dispatch:

jobs: build-and-deploy: runs-on: ubuntu-latest steps: - uses: actions/checkout@v4

  - name: Use Node.js 20
    uses: actions/setup-node@v3
    with:
      node-version: 20
      cache: 'npm'

  - name: Install deps
    run: npm ci

  - name: Build (standalone)
    run: |
      npm run build
      mkdir deploy
      # standalone 実行に必要な成果物をまとめる
      cp -R .next/standalone/* deploy/
      cp -R .next/static deploy/.next/static
      cp -R public deploy/public || true
      cp [package.json](http://_vscodecontentref_/2) deploy/
      cp [server.js](http://_vscodecontentref_/3) deploy/
      if [ -f [web.config](http://_vscodecontentref_/4) ]; then cp [web.config](http://_vscodecontentref_/5) deploy/; fi

  - name: Deploy to Azure Web App
    uses: azure/webapps-deploy@v2
    with:
      app-name: app-002-gen10-step3-2-node-oshima13
      publish-profile: 
